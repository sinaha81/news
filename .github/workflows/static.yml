# .github/workflows/webhook-receiver.yml

name: Receive and Overwrite Latest Analysis

on:
  repository_dispatch:
    types: [add_analysis]

jobs:
  update_json_file:
    runs-on: ubuntu-latest
    steps:
      # Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯ Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT_TOKEN }}

      # Ù…Ø±Ø­Ù„Ù‡ Û²: Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ ÙØ§ÛŒÙ„ analysis.json Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
      - name: Overwrite analysis.json
        run: |
          # ÛŒÚ© Ù¾ÙˆØ´Ù‡ Ø¨Ù‡ Ø§Ø³Ù… data Ù…ÛŒâ€ŒØ³Ø§Ø²ÛŒÙ… (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡)
          mkdir -p data
          
          # â€¼ï¸ Ù†Ú©ØªÙ‡ Ú©Ù„ÛŒØ¯ÛŒ Ø§ÛŒÙ†Ø¬Ø§Ø³Øª â€¼ï¸
          # Ù…Ø§ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² > ÙØ§ÛŒÙ„ Ø±Ùˆ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
          # Ø§Ø³Ù… ÙØ§ÛŒÙ„ Ù‡Ù… Ø¨Ù‡ ØµÙˆØ±Øª Ù…ÙØ±Ø¯ Ø¯Ø± Ø§ÙˆÙ…Ø¯Ù‡: analysis.json
          echo '${{ github.event.client_payload.analysis }}' > data/analysis.json
          
      # Ù…Ø±Ø­Ù„Ù‡ Û³: Ú©Ø§Ù…ÛŒØª Ú©Ø±Ø¯Ù† Ùˆ Ù¾ÙˆØ´ Ú©Ø±Ø¯Ù† ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ
      - name: Commit and push if it changed
        uses: EndBug/add-and-commit@v9
        with:
          author_name: "Automated Analyst Bot"
          author_email: "bot@github.com"
          message: "ğŸš€ Updated latest analysis"
          # ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù…ÛŒØª Ø´Ø¯Ù† Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
          add: "data/analysis.json"
